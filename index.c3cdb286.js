async function e(e){return(await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}async function t(t){const n=await e(`https://gogoanime.consumet.org/search?keyw=${t}`);if(n&&0===n.length)throw Error("request is wrong");return n}async function n(t){const n=await e(`https://gogoanime.consumet.org/anime-details/${t}`);if(n&&n.error)throw new Error(n.error.message);return n}const a="history_cursor",r="history_max",o="history_count",s=document.getElementById("request"),i=document.getElementById("searchResult"),l=document.getElementById("searchContent"),c=document.getElementById("history"),d=document.getElementById("error");(async()=>{function e(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function g(e){const t=[];if(localStorage.length<=3)return[];try{for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s!==a&&s!==o&&s!==r){const n=JSON.parse(localStorage.getItem(s));new RegExp(e.toLowerCase()).test(n.animeTitle.toLowerCase())&&t.push(n)}}}catch(e){d.innerHTML="History error, please update the page"}return t}function m(e){for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n!==a&&n!==o&&n!==r){if(JSON.parse(localStorage.getItem(n)).animeId===e)return!0}}return!1}function u(e){const t=Number(localStorage.getItem(o));if(t&&e>=t)throw new RangeError("index very big");const n=Number(localStorage.getItem(a)),s=Number(localStorage.getItem(r));let i=n-1-e;return i<0&&(i+=s),JSON.parse(localStorage.getItem(i))}function h(t){if(!Array.isArray(t))throw new TypeError("is not array");if(0!==t.length){e(i);for(let e=0;e<t.length&&!(e>=10);e++){const n=f(t[e]);i.appendChild(n)}i.classList.add("search-line__result_shown")}}async function p(t){const a=await n(t);return e(l),l.appendChild(function(e){const t=document.createElement("div");t.classList.add("details");const n=document.createElement("h2");n.classList.add("heading","heading_level-2"),n.innerHTML=e.animeTitle,t.appendChild(n);const a=document.createElement("div");a.classList.add("details__image-container");const r=document.createElement("img");r.src=e.animeImg,r.alt="anime image",a.appendChild(r),t.appendChild(a);const o=document.createElement("div");return o.classList.add("details__info"),o.innerHTML=`<p><strong>Genres: </strong>${e.genres.join(", ")}</p>`,o.innerHTML+=`<p><strong>Release date: </strong>${e.releasedDate}</p>`,o.innerHTML+=`<p><strong>Total episodes: </strong>${e.totalEpisodes}</p>`,o.innerHTML+=`<p><strong>Synopsis: </strong>${e.synopsis}</p>`,t.appendChild(o),t}(a)),a}function y(){const t=Number(localStorage.getItem(o));if(0===t)return;try{c.classList.remove("history_hide"),e(c);const n=document.createElement("h2");n.classList.add("heading","heading_level-2"),n.textContent="Recent results:",c.appendChild(n);for(let e=0;e<3&&!(e>=t);e++){const t=u(e),n=document.createElement("a");n.href="#",n.textContent=t.animeTitle,n.onclick=async e=>{e.preventDefault(),s.value="",await p(t.animeId)},c.appendChild(n)}}catch(e){d.innerHTML="History error, please update the page"}}function f(t){const n=document.createElement("div");n.classList.add("search-line__result-item"),t.isHistory&&n.classList.add("search-line__result-item_history"),n.innerHTML=t.animeTitle;const l=document.createElement("input");return l.type="hidden",l.value=t.animeId,n.appendChild(l),n.addEventListener("click",(()=>{const t=n.getElementsByTagName("input")[0].value;s.value=t,async function(e){try{!function(e,t){let n=Number(localStorage.getItem(a)),s=Number(localStorage.getItem(o));const i=Number(localStorage.getItem(r));if(!m(e))try{localStorage.setItem(n,JSON.stringify({animeId:e,animeTitle:t})),n=(n+1)%i,s<i&&(s+=1,localStorage.setItem(o,s)),localStorage.setItem(a,n)}catch(e){d.innerHTML="History error, please update the page"}}(e,(await p(e)).animeTitle),y()}catch(e){d.innerHTML="Cant show details, please update the page"}}(t),e(i),i.classList.remove("search-line__result_shown")})),n}localStorage.length>3?y():c.classList.add("history_hide"),localStorage.getItem(a)||localStorage.setItem(a,0),localStorage.getItem(r)||localStorage.setItem(r,100),localStorage.getItem(o)||localStorage.setItem(o,0),window.addEventListener("storage",(()=>{y()})),s.addEventListener("input",(async e=>{const n=e.target.value;if(!(n.length<2))try{const e=await t(n),a=g(n).map((e=>({...e,isHistory:!0})));h(a.concat(e.filter((e=>!m(e.animeId))).map((e=>({...e,isHistory:!1})))))}catch(e){d.innerHTML="Cant show results, please update the page"}})),s.addEventListener("focus",(e=>{try{const t=e.target.value;if(""===t){h(g(t).map((e=>({...e,isHistory:!0}))))}}catch(e){d.innerHTML="Cant show results, please update the page"}})),document.addEventListener("click",(t=>{t.target!==s&&(e(i),i.classList.remove("search-line__result_shown"))}))})();
//# sourceMappingURL=index.c3cdb286.js.map
