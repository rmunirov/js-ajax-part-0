async function e(e){return(await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"})).json()}async function t(t){const n=await e(`https://gogoanime.consumet.org/anime-details/${t}`);if(n&&n.error)throw new Error(n.error.message);return n}function n(e){for(;e.firstChild;)e.removeChild(e.firstChild)}const r="history_cursor",a="history_max",o="history_count";function s(e,t){try{localStorage.setItem(e,t)}catch(e){throw new Error("History error, please update the page")}}function i(e){const t=[];if(m())return[];try{for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s!==r&&s!==o&&s!==a){const n=JSON.parse(localStorage.getItem(s));new RegExp(e.toLowerCase()).test(n.animeTitle.toLowerCase())&&t.push(n)}}}catch(e){throw new Error("History error, please update the page")}return t}function c(e){try{for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n&&n!==r&&n!==o&&n!==a){if(JSON.parse(localStorage.getItem(n)).animeId===e)return!0}}return!1}catch(e){throw new Error("History error, please update the page")}}function l(e,t){let n=Number(localStorage.getItem(r)),i=Number(localStorage.getItem(o));const l=Number(localStorage.getItem(a));if(!n||!i||!l)throw new Error("History error, please update the page");c(e)||(s(n,JSON.stringify({animeId:e,animeTitle:t})),n=(n+1)%l,i<l&&(i+=1,s(o,i)),s(r,n))}function d(e){try{const t=Number(localStorage.getItem(o));if(t&&e>=t)throw new RangeError("Passed index very big");const n=Number(localStorage.getItem(r)),s=Number(localStorage.getItem(a));if(!n||!s)throw new Error("History error, please update the page");let i=n-1-e;return i<0&&(i+=s),JSON.parse(localStorage.getItem(i))}catch(e){if(e instanceof SyntaxError)throw new Error("History error, please update the page");throw e}}function m(){return localStorage.length<=3}const u=document.getElementById("request"),g=document.getElementById("searchResult"),h=document.getElementById("searchContent"),p=document.getElementById("history"),y=document.getElementById("error");(async()=>{try{f=L,localStorage.getItem(r)||s(r,0),localStorage.getItem(a)||s(a,100),localStorage.getItem(o)||s(o,0),window.addEventListener("storage",(()=>{f()}))}catch(e){y.innerHTML=e.message}var f;function w(e){if(!Array.isArray(e))throw new TypeError("is not array");if(0!==e.length){n(g);for(let t=0;t<e.length&&!(t>=10);t++){const n=v(e[t]);g.appendChild(n)}g.classList.add("search-line__result_shown")}}async function E(e){const r=await t(e);return n(h),h.appendChild(function(e){const t=document.createElement("div");t.classList.add("details");const n=document.createElement("h2");n.classList.add("heading","heading_level-2"),n.innerHTML=e.animeTitle,t.appendChild(n);const r=document.createElement("div");r.classList.add("details__image-container");const a=document.createElement("img");a.src=e.animeImg,a.alt="anime image",r.appendChild(a),t.appendChild(r);const o=document.createElement("div");return o.classList.add("details__info"),o.innerHTML=`<p><strong>Genres: </strong>${e.genres.join(", ")}</p>`,o.innerHTML+=`<p><strong>Release date: </strong>${e.releasedDate}</p>`,o.innerHTML+=`<p><strong>Total episodes: </strong>${e.totalEpisodes}</p>`,o.innerHTML+=`<p><strong>Synopsis: </strong>${e.synopsis}</p>`,t.appendChild(o),t}(r)),r}function L(){const e=Number(localStorage.getItem(o));if(0===e)return;try{p.classList.remove("history_hide"),n(p);const t=document.createElement("h2");t.classList.add("heading","heading_level-2"),t.textContent="Recent results:",p.appendChild(t);for(let t=0;t<3&&!(t>=e);t++){const e=d(t),n=document.createElement("a");n.href="#",n.textContent=e.animeTitle,n.onclick=async t=>{t.preventDefault(),u.value="",await E(e.animeId)},p.appendChild(n)}}catch(e){y.innerHTML=e.message}}function v(e){const t=document.createElement("div");t.classList.add("search-line__result-item"),e.isHistory&&t.classList.add("search-line__result-item_history"),t.innerHTML=e.animeTitle;const r=document.createElement("input");return r.type="hidden",r.value=e.animeId,t.appendChild(r),t.addEventListener("click",(()=>{const r=t.getElementsByTagName("input")[0].value;u.value=e.animeTitle,async function(e){try{l(e,(await E(e)).animeTitle),L()}catch(e){y.innerHTML="Cant show details, please update the page"}}(r),n(g),g.classList.remove("search-line__result_shown")})),t}m()?p.classList.add("history_hide"):L();const I=(S=async function(t){const n=t.target.value;if(!(n.length<2))try{const t=await async function(t){const n=await e(`https://gogoanime.consumet.org/search?keyw=${t}`);if(n&&0===n.length)throw Error("request is wrong");return n}(n),r=i(n).map((e=>({...e,isHistory:!0}))).slice(0,5);w(r.concat(t.filter((e=>!c(e.animeId))).map((e=>({...e,isHistory:!1})))))}catch(e){y.innerHTML="Cant show results, please update the page"}},T=500,function(...e){const t=this.lastCall;this.lastCall=Date.now(),t&&this.lastCall-t<=T&&clearTimeout(this.timer),this.timer=setTimeout((()=>{S(...e)}),T)});var S,T;u.addEventListener("input",I),u.addEventListener("focus",(function(e){try{const t=e.target.value;if(""===t){w(i(t).map((e=>({...e,isHistory:!0}))))}}catch(e){y.innerHTML="Cant show results, please update the page"}})),document.addEventListener("click",(function(e){e.target!==u&&(n(g),g.classList.remove("search-line__result_shown"))}))})();
//# sourceMappingURL=index.e9fe0c5e.js.map
